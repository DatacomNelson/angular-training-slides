<!DOCTYPE HTML>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="search-domain" content="http://rangle.io" />
    <link href="http://localhost:4000/css/bootstrap.css" rel="stylesheet" />
    <link href="http://localhost:4000/css/bootstrap-theme.css" rel="stylesheet" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Handling Events</title>
  </head>
  <body>
    <div class="container shadow">
      <div class="row-fluid">
        <div class="span10 offset1">
          <p><a href="http://rangle.io">Rangle.io</a> Angular Training</a></p>
          <h1>Handling Events</h1>
          <hr />
<!-- .slide: id="events-roadmap" -->
<h2 id="roadmap">Roadmap</h2>

<ol>
  <li>How do I handle events?</li>
  <li>How do I handle user input?</li>
  <li>How do I make a reusable component?</li>
  <li>How do child components send data to their parents?</li>
  <li>How do I use two-way databinding?</li>
</ol>

<hr />
<!-- .slide: id="events-handling-events" -->
<h2 id="handling-events">Handling Events</h2>

<ul>
  <li>Bind an expression to any DOM event using <code class="highlighter-rouge">(event)="action"</code> in a tag</li>
  <li><code class="highlighter-rouge">event</code> is what to handle</li>
  <li><code class="highlighter-rouge">action</code> is what to do
    <ul>
      <li>Almost always a method call</li>
    </ul>
  </li>
</ul>

<hr />
<!-- .slide: id="events-adding-items-1" -->
<h2 id="adding-items-to-the-list">Adding Items to the List</h2>

<ul>
  <li>Create a button</li>
  <li>Have its <code class="highlighter-rouge">click</code> event call <code class="highlighter-rouge">addToDo</code> with a fixed string</li>
</ul>

<p><em>src/app/to-do-list/to-do-list.component.html</em></p>
<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li</span> <span class="err">*</span><span class="na">ngFor=</span><span class="s">"let item of thingsToDo; let i = index"</span> <span class="na">id=</span><span class="s">"{{i}}"</span><span class="nt">&gt;</span>{{item}}<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;button</span> <span class="err">(</span><span class="na">click</span><span class="err">)="</span><span class="na">addToDo</span><span class="err">('</span><span class="na">make</span> <span class="na">coffee</span><span class="err">')"</span><span class="nt">&gt;</span>make coffee<span class="nt">&lt;/button&gt;</span>
</code></pre>
</div>

<hr />
<!-- .slide: id="events-adding-items-2" -->
<h2 id="adding-items-to-the-list-1">Adding Items to the List</h2>

<ul>
  <li>Create the corresponding method in the component class</li>
</ul>

<p><em>src/app/to-do-list/to-do-list.component.ts</em></p>
<div class="language-ts highlighter-rouge"><pre class="highlight"><code><span class="k">export</span> <span class="kr">class</span> <span class="nx">ToDoListComponent</span> <span class="k">implements</span> <span class="nx">OnInit</span> <span class="p">{</span>
  <span class="c1">// ...as before...</span>

  <span class="nx">addToDo</span><span class="p">(</span><span class="nx">text</span><span class="err">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">thingsToDo</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p><img src="images/screenshot-add-constant.png" alt="Adding Items With a Button" /></p>

<hr />
<!-- .slide: id="events-adding-specific-items-1" -->
<h2 id="adding-specific-items">Adding Specific Items</h2>

<ul>
  <li>Add an <code class="highlighter-rouge">input</code> field</li>
  <li>Create a local variable <em>in the template</em> to hold its value using <code class="highlighter-rouge">#newItem</code>
    <ul>
      <li><code class="highlighter-rouge">newItem</code> is <em>not</em> a member of the component class</li>
    </ul>
  </li>
  <li>Modify the method call to pass that variable</li>
</ul>

<p><em>src/app/to-do-list/to-do-list.component.html</em></p>
<div class="language-html highlighter-rouge"><pre class="highlight"><code>// ...as before...
<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;input</span> <span class="err">#</span><span class="na">newItem</span> <span class="na">placeholder=</span><span class="s">"item"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;button</span> <span class="err">(</span><span class="na">click</span><span class="err">)="</span><span class="na">addToDo</span><span class="err">(</span><span class="na">newItem</span><span class="err">)"</span><span class="nt">&gt;</span>+<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/p&gt;</span>
</code></pre>
</div>

<hr />
<!-- .slide: id="events-adding-specific-items-2" -->
<h2 id="adding-specific-items-1">Adding Specific Items</h2>

<ul>
  <li>Fill in the input field</li>
  <li>Click the button</li>
</ul>

<p><img src="images/screenshot-add-element.png" alt="Adding an Element (Mistaken)" /></p>

<ul>
  <li>Oops</li>
</ul>

<hr />
<!-- .slide: id="events-adding-specific-items-3" -->
<h2 id="adding-specific-items-fixed">Adding Specific Items (Fixed)</h2>

<ul>
  <li><code class="highlighter-rouge">newItem</code> is a whole object, not just the text</li>
  <li>use <code class="highlighter-rouge">text.value</code> in <code class="highlighter-rouge">addToDo</code>
    <ul>
      <li>and then clear it to empty out the input box</li>
    </ul>
  </li>
</ul>

<p><em>src/app/to-do-list/to-do-list.component.ts</em></p>
<div class="language-ts highlighter-rouge"><pre class="highlight"><code><span class="k">export</span> <span class="kr">class</span> <span class="nx">ToDoListComponent</span> <span class="k">implements</span> <span class="nx">OnInit</span> <span class="p">{</span>
  <span class="c1">// ...as before...</span>

  <span class="nx">addToDo</span><span class="p">(</span><span class="nx">text</span><span class="err">:</span> <span class="nx">HTMLInputElement</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">thingsToDo</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">text</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
    <span class="nx">text</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<hr />
<!-- .slide: id="events-reusable-components" -->
<h2 id="making-a-reusable-component">Making a Reusable Component</h2>

<ul>
  <li>A text input with a button feels like something we could re-use</li>
  <li>Want to have:
    <ul>
      <li>Button with user-specified label</li>
      <li>Text input field</li>
      <li><em>Some way to get the data into the parent</em></li>
    </ul>
  </li>
  <li>Have the component emit events</li>
  <li>Angular presents them in the same way as built-in events like <code class="highlighter-rouge">click</code></li>
</ul>

<hr />
<!-- .slide: id="events-component-skeleton" -->
<h2 id="create-the-component-skeleton">Create the Component Skeleton</h2>

<ul>
  <li><code class="highlighter-rouge">ng generate component genericInput</code></li>
  <li>Creates <code class="highlighter-rouge">src/app/generic-input/*</code></li>
</ul>

<hr />
<!-- .slide: id="events-move-the-html" -->
<h2 id="move-the-html">Move the HTML</h2>

<p><em>src/app/to-do-list/to-do-list.component.html</em></p>
<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li</span> <span class="err">*</span><span class="na">ngFor=</span><span class="s">"let item of thingsToDo; let i = index"</span> <span class="na">id=</span><span class="s">"{{i}}"</span><span class="nt">&gt;</span>{{item}}<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;app-generic-input&gt;&lt;/app-generic-input&gt;</span>
</code></pre>
</div>

<p><em>src/app/generic-input/generic-input.component.html</em></p>
<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;input</span> <span class="err">#</span><span class="na">newItem</span> <span class="na">placeholder=</span><span class="s">"item"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;button</span> <span class="err">(</span><span class="na">click</span><span class="err">)="</span><span class="na">addToDo</span><span class="err">(</span><span class="na">newItem</span><span class="err">)"</span><span class="nt">&gt;</span>+<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/p&gt;</span>
</code></pre>
</div>

<hr />
<!-- .slide: id="events-move-the-method" -->
<h2 id="move-the-method">Move the Method</h2>

<ul>
  <li>Remove <code class="highlighter-rouge">addToDo</code> from <code class="highlighter-rouge">ToDoListComponent</code></li>
  <li>Put it in <code class="highlighter-rouge">GenericInputComponent</code></li>
</ul>

<p><em>src/app/generic-input/generic-input.component.ts</em></p>
<div class="language-ts highlighter-rouge"><pre class="highlight"><code><span class="k">export</span> <span class="kr">class</span> <span class="nx">GenericInputComponent</span> <span class="k">implements</span> <span class="nx">OnInit</span> <span class="p">{</span>
  <span class="c1">// ...as before...</span>
  <span class="nx">addToDo</span><span class="p">(</span><span class="nx">text</span><span class="err">:</span> <span class="nx">HTMLInputElement</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">thingsToDo</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">text</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
    <span class="nx">text</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<ul>
  <li>Causes a compilation error because <code class="highlighter-rouge">GenericInputComponent</code> doesn’t have <code class="highlighter-rouge">thingsToDo</code></li>
</ul>

<hr />
<!-- .slide: id="events-create-event-emitter-1" -->
<h2 id="create-an-event-emitter">Create an Event Emitter</h2>

<p><em>src/app/generic-input/generic-input.component.ts</em></p>
<div class="language-ts highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">OnInit</span><span class="p">,</span> <span class="nx">Output</span><span class="p">,</span> <span class="nx">EventEmitter</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'@angular/core'</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="c1">// ...as before...</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kr">class</span> <span class="nx">GenericInputComponent</span> <span class="k">implements</span> <span class="nx">OnInit</span> <span class="p">{</span>

  <span class="err">@</span><span class="nx">Output</span><span class="p">()</span> <span class="nx">newItem</span><span class="err">:</span> <span class="nx">EventEmitter</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventEmitter</span><span class="p">();</span>

  <span class="c1">// ...constructor and ngOnInit as before...</span>

  <span class="nx">addToDo</span><span class="p">(</span><span class="nx">text</span><span class="err">:</span> <span class="nx">HTMLInputElement</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">newItem</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">text</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
    <span class="nx">text</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<hr />
<!-- .slide: id="events-create-event-emitter-2" -->
<h2 id="a-what">A What?</h2>

<ul>
  <li><code class="highlighter-rouge">EventEmitter</code> can send things to anyone who’s listening</li>
  <li>Class is <em>generic</em>
    <ul>
      <li>Must provide an actual type for events as in <code class="highlighter-rouge">EventEmitter&lt;string&gt;</code></li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">GenericInputComponent</code> is now emitting events, but nobody is listening</li>
</ul>

<hr />
<!-- .slide: id="events-refactor" -->
<h2 id="refactor-the-main-application">Refactor the Main Application</h2>

<ol>
  <li>Move <code class="highlighter-rouge">&lt;app-generic-input&gt;</code> to <code class="highlighter-rouge">app.component.html</code>
    <ul>
      <li>I.e., make input and display siblings instead of nesting</li>
      <li>Saves us one level of indirection</li>
    </ul>
  </li>
  <li>Add an event handler in <code class="highlighter-rouge">app.component.html</code>
    <ul>
      <li>Name is the name of the <code class="highlighter-rouge">@Output</code> member variable in <code class="highlighter-rouge">GenericInputComponent</code></li>
    </ul>
  </li>
</ol>

<p><em>src/app/app.component.html</em></p>
<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>{{title}}<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;app-to-do-list</span> <span class="err">[</span><span class="na">thingsToDo</span><span class="err">]="</span><span class="na">thingsToDo</span><span class="err">"</span><span class="nt">&gt;&lt;/app-to-do-list&gt;</span>
<span class="nt">&lt;app-generic-input</span> <span class="err">(</span><span class="na">newItem</span><span class="err">)="</span><span class="na">onNewItem</span><span class="err">($</span><span class="na">event</span><span class="err">)"</span><span class="nt">&gt;&lt;/app-generic-input&gt;</span>
</code></pre>
</div>

<ul>
  <li>The <code class="highlighter-rouge">onNewItem</code> event handler is a public method on the <code class="highlighter-rouge">AppComponent</code> class</li>
  <li><code class="highlighter-rouge">$event</code> is a special Angular variable that represents the value emitted by the captured event
    <ul>
      <li>In our case, the string inputted by the user</li>
    </ul>
  </li>
</ul>

<hr />
<!-- .slide: id="events-connect-the-wires" -->
<h2 id="connect-the-wires">Connect the Wires</h2>

<p><em>src/app/app.component.ts</em></p>
<div class="language-ts highlighter-rouge"><pre class="highlight"><code><span class="k">export</span> <span class="kr">class</span> <span class="nx">AppComponent</span> <span class="p">{</span>

  <span class="nx">title</span> <span class="o">=</span> <span class="s1">'To Do'</span><span class="p">;</span>
  <span class="nx">thingsToDo</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'Learn JavaScript'</span><span class="p">,</span>
    <span class="s1">'Learn Angular'</span><span class="p">,</span>
    <span class="s1">'Learn Redux'</span>
  <span class="p">];</span>

  <span class="nx">onNewItem</span><span class="p">(</span><span class="nx">item</span><span class="err">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">thingsToDo</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<ul>
  <li>No other changes needed</li>
</ul>

<hr />
<!-- .slide: id="events-final-appearance" -->
<h2 id="final-appearance">Final Appearance</h2>

<p><img src="images/screenshot-handling-event.png" alt="Connecting the Wires" /></p>

<p>FIXME: diagram showing data flow</p>

<hr />
<!-- .slide: id="events-quiz-1" -->
<!-- .slide: data-background="images/question-slide.jpg" -->

<h2 id="quiz">Quiz</h2>

<p>Which of the following is invalid syntax for handling an event?</p>

<ol>
  <li>
    <p><code class="highlighter-rouge">&lt;message (messageSent)="onMessageSent($event)"&gt;&lt;/message&gt;</code></p>
  </li>
  <li>
    <p><code class="highlighter-rouge">&lt;message (messageSent)="onMessageSent(message)"&gt;&lt;/message&gt;</code></p>
  </li>
  <li>
    <p><code class="highlighter-rouge">&lt;message messageSent="onMessageSent($event)"&gt;&lt;/message&gt;</code></p>
  </li>
  <li>
    <p><code class="highlighter-rouge">&lt;message (messageSent)="sent=$event"&gt;&lt;/message&gt;</code></p>
  </li>
</ol>

<p>+++
<!-- .slide: data-background="images/answer-slide.jpg" --></p>

<h2 id="answer">Answer</h2>

<p>Correct answer is 3.</p>

<p>1: Values emitted are exposed via the <code class="highlighter-rouge">$event</code> variable.</p>

<p>2: This answer may expose a misunderstanding that values referenced as
callback arguments are class members.</p>

<p>3: Not choosing this answer may expose confusion in terms of inputs
vs. outputs, and/or two-way bound <code class="highlighter-rouge">[()]</code> properties.</p>

<p>4: This answer may expose a misunderstanding that values passed into
outputs must be callbacks. In reality, they are simply expressions
which also have special handling for callback syntax</p>

<hr />
<!-- .slide: id="events-quiz-2" -->
<!-- .slide: data-background="images/question-slide.jpg" -->

<h2 id="quiz-1">Quiz</h2>

<p>What is the difference between:</p>

<p>(A) <code class="highlighter-rouge">&lt;counter [count]="count()"&gt;&lt;/counter&gt;</code></p>

<p>(B) <code class="highlighter-rouge">&lt;counter (count)="count()"&gt;&lt;/counter&gt;</code></p>

<ol>
  <li>
    <p>None.</p>
  </li>
  <li>
    <p>(A) passes the result of calling <code class="highlighter-rouge">this.count()</code> into the <code class="highlighter-rouge">&lt;counter&gt;</code> component via an input.
(B) calls <code class="highlighter-rouge">this.count()</code> whenever the <code class="highlighter-rouge">&lt;counter&gt;</code> component emits a value through its own <code class="highlighter-rouge">EventEmitter</code> member <code class="highlighter-rouge">count</code>.</p>
  </li>
  <li>
    <p>(A) calls <code class="highlighter-rouge">this.count()</code> whenever the <code class="highlighter-rouge">&lt;counter&gt;</code> component emits a value through its own <code class="highlighter-rouge">EventEmitter</code> member <code class="highlighter-rouge">count</code>.
(B) passes the resulting value of calling <code class="highlighter-rouge">this.count()</code> into the <code class="highlighter-rouge">&lt;counter&gt;</code> component via an input.</p>
  </li>
  <li>
    <p>(A) emits a value from the parent into the <code class="highlighter-rouge">&lt;counter&gt;</code> component from an <code class="highlighter-rouge">EventEmitter</code> member called <code class="highlighter-rouge">count</code>.
(B) assigns values emitted from the <code class="highlighter-rouge">&lt;counter&gt;</code> component to <code class="highlighter-rouge">this.count</code>.</p>
  </li>
</ol>

<p>+++
<!-- .slide: data-background="images/answer-slide.jpg" --></p>

<h2 id="answer-1">Answer</h2>

<p>Correct answer is 2.</p>

<p>1, 3, 4: This answer may expose a misunderstanding of the input <code class="highlighter-rouge">[]</code>
output <code class="highlighter-rouge">()</code> paradigm and what the syntax represents.</p>

<hr />
<!-- .slide: id="events-quiz-3" -->
<h2 id="question">Question</h2>

<p>Given the following components, which message will be logged to the console when <code class="highlighter-rouge">child</code>’s button is clicked?</p>

<div class="language-ts highlighter-rouge"><pre class="highlight"><code><span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="s1">'parent'</span><span class="p">,</span>
  <span class="na">template</span><span class="p">:</span> <span class="s1">'&lt;child (messageSent)="handleMessageSent($event)"&gt;&lt;/child&gt;'</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kr">class</span> <span class="nx">Parent</span> <span class="p">{</span>
  <span class="err">@</span><span class="nx">Output</span><span class="p">()</span> <span class="nx">messageSent</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventEmitter</span><span class="p">();</span>
  <span class="nx">message</span> <span class="o">=</span> <span class="s1">'I am the parent'</span><span class="p">;</span>
  <span class="nx">handleMessageSent</span><span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="s1">'child'</span><span class="p">,</span>
  <span class="na">template</span><span class="p">:</span> <span class="s1">'&lt;button (click)="sendMessage()"&gt;Click me&lt;/button&gt;'</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kr">class</span> <span class="nx">Child</span> <span class="p">{</span>
  <span class="err">@</span><span class="nx">Output</span><span class="p">()</span> <span class="nx">messageSent</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventEmitter</span><span class="p">();</span>
  <span class="nx">message</span> <span class="o">=</span> <span class="s1">'I am the child'</span><span class="p">;</span>
  <span class="nx">handleMessageSent</span><span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span> <span class="p">}</span>
  <span class="nx">sendMessage</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">messageSent</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<hr />
<!-- .slide: id="events-quiz-4" -->
<!-- .slide: data-background="images/question-slide.jpg" -->

<h2 id="quiz-continued">Quiz (continued)</h2>

<ol>
  <li>
    <p>I am the child</p>
  </li>
  <li>
    <p>I am the parent<br />
I am the child</p>
  </li>
  <li>
    <p>I am the child<br />
I am the parent</p>
  </li>
  <li>
    <p>I am the parent</p>
  </li>
</ol>

<p>+++
<!-- .slide: data-background="images/answer-slide.jpg" --></p>

<h2 id="answer-2">Answer</h2>

<p>Correct answer is 4.</p>

<p>1: This answer may expose confusion between which component actually
handles the event.</p>

<p>2,3: This answer may expose a misunderstanding that both child and
parent components are able to listen to the custom event, and thus
both log their messages.</p>

          <hr/>
          <a href="http://localhost:4000/">Home</a>
        </div>
      </div>
    </div>
  </body>
</html>
